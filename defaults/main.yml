---
# Copyright (c) 2021 Mohamed Tawfik <m_tawfik@aucegypt.edu>

### Global configuration
### ---------------------------------------------------

# Enable or disable the role
syncoid__enabled: False

# Purge old config files
syncoid__purge_old_configs: True

### APT packages
### ---------------------------------------------------

# Name of the "sanoid" package to install
syncoid__sanoid_package_name: 'sanoid'

# List of base APT packages to install.
syncoid__base_packages:
- '{{ syncoid__sanoid_package_name }}'

# List of additional APT packages to install.
syncoid__packages: []

### Backup client environment
### ---------------------------------------------------

# Absolute path of the directory which contains the global syncoid configuration for each host@dataset to back up
syncoid__config_global_dir: "/etc/syncoid"

# Absolute path of the directory which contains the global syncoid configuration for each host@dataset to back up
syncoid__config_datasets_dir: '{{ syncoid__config_global_dir }}/datasets'

# Name of zpool to use for snapshots
# Leave empty to use the largest sized zpool
syncoid__snapshot_pool: ''

# Dataset name, relative to `syncoid__snapshot_pool`, which contains snapshots of the remote hosts' datasets, in separate directories.
syncoid__snapshot_dataset: 'backup/syncoid/hosts'

# Username with which to SSH to each host to back up
syncoid__user: 'syncoid'

### Backup client SSH configuration
### ---------------------------------------------------

# The default size of the SSH RSA keys generated by the role.
syncoid__ssh_key_bits: 4096

# The comment added to the SSH keys generated by the role.
syncoid__ssh_key_comment: '{{ syncoid__user }}@{{ ansible_fqdn }} generated by dejarik-ra.syncoid via Ansible'

# The default SSH key type of the keys generated by the role.
syncoid__ssh_key_type: '{{ ansible_local.root_account.ssh_key_type|d("rsa") }}'

# Dictionary of the default SSH identity (SSH keypair stored in the
# :file:`/root/.ssh/` directory) created by the role.
syncoid__ssh_default_identity:
  name: 'id_syncoid_rsa'
  type: 'rsa'

# List of additional SSH identities created by the role.
syncoid__ssh_identities: []

# The default SSH identity used by the :command:`syncoid` to connect to the
# hosts if no custom identity has been set via the ``item.ssh_identity``
# parameter.
syncoid__ssh_main_identity: 'id_syncoid_rsa'

### Syncoid dataset options configuration
### ---------------------------------------------------

# Default template of dataset options to use when running a `syncoid` command
syncoid__default_dataset_options:
  name: default
  # identifier: backup
  recursive: True
  # skip_parent: True
  no_stream: True
  no_sync_snap: True
  create_bookmark: True
  # no_clone_rollback: True
  # no_rollback: True
  send_options: "w"
  # receive_options: ""
  # exclude: $'none^'

# Dataset options templates which should be defined on all syncoid backup clients in the Ansible inventory.
syncoid__dataset_options_templates: []

# Dataset options templates which should be defined on a group of syncoid backup clients in the Ansible inventory.
syncoid__group_dataset_options_templates: []

# Dataset options templates which should be defined on specific syncoid backup clients in the Ansible inventory.
syncoid__host_dataset_options_templates: []

# Order in which dataset options templates are defined and affect each other.
# This list is then passed to the parser template to generate final dictionary with dataset options templates for syncoid.
syncoid__combined_dataset_options_templates: '{{ q("flattened",
                                                    [ syncoid__default_dataset_options ]
                                                    + syncoid__dataset_options_templates
                                                    + syncoid__group_dataset_options_templates 
                                                    + syncoid__host_dataset_options_templates) }}'

### Syncoid connection options configuration
### ---------------------------------------------------

# Default template of connection options to use when running a `syncoid` command
syncoid__default_connection_options:
  name: default
  compress: lzo
  source_bwlimit_mebibyte: 100
  target_bwlimit_mebibyte: 100

# Connection options templates which should be defined on all syncoid backup clients in the Ansible inventory.
syncoid__connection_options_templates: 
  - name: test
    source_bwlimit_mebibyte: 5
    target_bwlimit_mebibyte: 5

# Connection options templates which should be defined on a group of syncoid backup clients in the Ansible inventory.
syncoid__group_connection_options_templates: []

# Connection options templates which should be defined on specific syncoid backup clients in the Ansible inventory.
syncoid__host_connection_options_templates: []

# Order in which connection options templates are defined and affect each other.
# This list is then passed to the parser template to generate final dictionary with connection options templates for syncoid.
syncoid__combined_connection_options_templates: '{{ q("flattened",
                                                      [syncoid__default_connection_options]
                                                      + syncoid__connection_options_templates
                                                      + syncoid__group_connection_options_templates 
                                                      + syncoid__host_connection_options_templates) }}'
### Syncoid backup options configuration
### ---------------------------------------------------
# Backup configurations which should be defined on all syncoid backup clients in the Ansible inventory.
syncoid__backup_configurations: 
- source_host: 192.168.44.199
  source_dataset: tank/config

  # target_dataset: tank/config

  # ssh_identity: id_syncoid_rsa
  # ssh_port: 22

  dataset_template_name: default
  connection_template_name: default

  frequency: daily

  state: present

# Backup configurations which should be defined on a group of syncoid backup clients in the Ansible inventory.
syncoid__group_backup_configurations: []

# Backup configurations which should be defined on specific syncoid backup clients in the Ansible inventory.
syncoid__host_backup_configurations: []

# Order in which backup configurations are defined and affect each other.
# This list is then passed to the parser template to generate final dictionary with backup configurations for syncoid.
syncoid__combined_backup_configurations: '{{ q("flattened",
                                                syncoid__backup_configurations
                                                + syncoid__group_backup_configurations
                                                + syncoid__host_backup_configurations) }}'
